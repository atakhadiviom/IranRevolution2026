<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Admin Dashboard - Iran Revolution 2026</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="stylesheet" href="./src/admin.css" />
  </head>
  <body>
    <!-- Login Wrapper -->
    <div id="login-section" class="login-wrapper hidden">
      <div class="login-card">
        <div style="text-align: center; margin-bottom: 2rem;">
          <img src="./favicon.svg" alt="Logo" style="width: 48px; margin-bottom: 1rem;">
          <h1>Admin Login</h1>
          <p>Sign in to manage memorials</p>
        </div>
        <form id="login-form">
          <div class="form-group" style="margin-bottom: 1rem;">
            <label for="email">Email Address</label>
            <input type="email" id="email" placeholder="admin@example.com" required />
          </div>
          <div class="form-group" style="margin-bottom: 1.5rem;">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%;">Sign In</button>
        </form>
        <p id="login-error" style="color: var(--danger); margin-top: 1rem; text-align: center; font-size: 0.85rem;" class="hidden"></p>
      </div>
    </div>

    <!-- Dashboard Layout -->
    <div id="admin-section" class="container hidden">
      <!-- Mobile Header -->
      <div class="mobile-header">
        <a href="/" class="sidebar-logo" style="margin-bottom: 0;">
          <img src="./favicon.svg" alt="Logo">
          <span>Admin</span>
        </a>
        <button id="mobile-menu-toggle" class="btn btn-secondary btn-sm">
          <span>Menu</span>
        </button>
      </div>

      <!-- Sidebar -->
      <aside class="sidebar">
        <a href="/" class="sidebar-logo">
          <img src="./favicon.svg" alt="Logo">
          <span>Admin Panel</span>
        </a>
        
        <nav class="nav-links">
          <li class="nav-item">
            <div id="nav-overview" class="nav-link active">
              <span>üìä Overview</span>
            </div>
          </li>
          <li class="nav-item">
            <div id="nav-submissions" class="nav-link">
              <span>üì• Submissions</span>
            </div>
          </li>
          <li class="nav-item">
            <div id="nav-memorials" class="nav-link">
              <span>üïØÔ∏è Memorials</span>
            </div>
          </li>
          <li class="nav-item">
            <div id="nav-editor" class="nav-link">
              <span>‚úèÔ∏è Editor</span>
            </div>
          </li>
          <li class="nav-item">
            <div id="nav-reports" class="nav-link">
              <span>üö© Reports</span>
            </div>
          </li>
        </nav>

        <div class="sidebar-footer">
          <div class="user-info">
            <span id="user-email"></span>
          </div>
          <button id="logout-btn" class="btn btn-secondary btn-sm" style="width: 100%;">
            <span>Logout</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Overview Section -->
        <section id="section-overview">
          <header>
            <h1>Dashboard Overview</h1>
            <div class="actions">
              <button id="refresh-stats-btn" class="btn btn-secondary btn-sm">Refresh Stats</button>
            </div>
          </header>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Total Memorials</div>
              <div id="stat-total" class="stat-value">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Verified</div>
              <div id="stat-verified" class="stat-value">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Pending Review</div>
              <div id="stat-pending" class="stat-value" style="color: var(--warning);">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Active Reports</div>
              <div id="stat-reports" class="stat-value" style="color: var(--danger);">0</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Quick Import</h2>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>‚ú® AI Extraction</label>
                <div style="display: flex; gap: 0.5rem;">
                  <input type="url" id="ai-url" placeholder="Paste X post or news URL..." style="flex: 1;" />
                  <button id="ai-extract-btn" class="btn btn-primary">Extract</button>
                </div>
                <div id="ai-status" class="hidden"></div>
              </div>
              <div class="form-group">
                <label>üìÑ JSON Import</label>
                <textarea id="json-import" placeholder='{ "name": "...", "city": "..." }' style="min-height: 44px;"></textarea>
                <button id="json-import-btn" class="btn btn-secondary btn-sm">Import JSON</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Maintenance Tasks</h2>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
              <button id="batch-img-btn" class="btn btn-secondary">üñºÔ∏è Sync Images</button>
              <button id="batch-translate-btn" class="btn btn-secondary">üåç AI Translation</button>
              <button id="batch-coords-btn" class="btn btn-secondary">üìç Sync Coords</button>
              <button id="find-duplicates-btn" class="btn btn-secondary">üîç Find Duplicates (FA)</button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Recent Submissions</h2>
            </div>
            <div style="overflow-x: auto;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>City</th>
                    <th>Submitted At</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="recent-list">
                  <!-- Recent entries will be injected here -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Submissions Section -->
        <section id="section-submissions" class="hidden">
          <header>
            <h1>Submissions</h1>
          </header>
          
          <div class="card">
            <div class="search-container">
              <input type="text" id="search-submissions" class="search-input" placeholder="Search submissions by name or city..." />
              <select id="sort-submissions" class="sort-select">
                <option value="date-desc">Newest First</option>
                <option value="date-asc">Oldest First</option>
                <option value="name-asc">Name (A-Z)</option>
                <option value="name-desc">Name (Z-A)</option>
                <option value="city-asc">City (A-Z)</option>
              </select>
            </div>
            <div style="overflow-x: auto;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>City</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="submissions-list">
                  <!-- Submissions will be injected here -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Memorials Section -->
        <section id="section-memorials" class="hidden">
          <header>
            <h1>Verified Memorials</h1>
          </header>
          
          <div class="card">
            <div class="search-container">
              <input type="text" id="search-memorials" class="search-input" placeholder="Search memorials..." />
              <select id="sort-memorials" class="sort-select">
                <option value="date-desc">Newest First</option>
                <option value="date-asc">Oldest First</option>
                <option value="name-asc">Name (A-Z)</option>
                <option value="name-desc">Name (Z-A)</option>
                <option value="city-asc">City (A-Z)</option>
              </select>
            </div>
            <div style="overflow-x: auto;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>City</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="verified-list">
                  <!-- Memorials will be injected here -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Editor Section -->
        <section id="section-editor" class="hidden">
          <header>
            <h1 id="editor-title">Add Memorial Entry</h1>
            <div class="actions" style="display: flex; gap: 0.5rem;">
              <button id="translate-entry-btn" class="btn btn-secondary btn-sm hidden">üåç Translate</button>
              <button id="merge-entry-btn" class="btn btn-secondary btn-sm hidden">üîó Merge</button>
              <button id="delete-entry-btn" class="btn btn-danger btn-sm hidden">üóëÔ∏è Delete</button>
              <button id="clear-btn" class="btn btn-secondary btn-sm">Clear Form</button>
            </div>
          </header>

          <div id="editor-status" class="hidden" style="margin-bottom: 1rem; padding: 0.75rem; border-radius: 4px; font-size: 0.9rem;"></div>

          <div class="card">
            <form id="entry-form" class="form-grid">
              <input type="hidden" id="edit-id" />
              
              <div class="form-group">
                <label for="name">Name (English) *</label>
                <input id="name" placeholder="John Doe" required />
                <div id="duplicate-warning" class="hidden" style="margin-top: 0.5rem; padding: 0.75rem; background: rgba(255, 193, 7, 0.1); border: 1px solid #ffc107; border-radius: 4px; color: #ffc107; font-size: 0.85rem;">
                  <!-- Duplicate info here -->
                </div>
              </div>
              <div class="form-group">
                <label for="name_fa">Name (Persian)</label>
                <input id="name_fa" placeholder="ŸÜÿßŸÖ" dir="rtl" />
              </div>
              
              <div class="form-group">
                <label for="city">City (English)</label>
                <input id="city" placeholder="Tehran" />
              </div>
              <div class="form-group">
                <label for="city_fa">City (Persian)</label>
                <input id="city_fa" placeholder="ÿ™Ÿáÿ±ÿßŸÜ" dir="rtl" />
              </div>
              
              <div class="form-group">
                <label for="location">Location (English)</label>
                <input id="location" placeholder="Behesht-e Zahra" />
              </div>
              <div class="form-group">
                <label for="location_fa">Location (Persian)</label>
                <input id="location_fa" placeholder="ÿ®Ÿáÿ¥ÿ™ ÿ≤Ÿáÿ±ÿß" dir="rtl" />
              </div>
              
              <div class="form-group">
                <label for="date">Date (YYYY-MM-DD)</label>
                <input id="date" type="date" />
              </div>
              <div class="form-group">
                <label>Coordinates</label>
                <div style="display: flex; gap: 0.5rem;">
                  <input id="lat" type="number" step="0.0001" placeholder="Lat" style="flex: 1;" />
                  <input id="lon" type="number" step="0.0001" placeholder="Lon" style="flex: 1;" />
                  <button type="button" id="sync-coords-btn" class="btn btn-secondary" title="Sync from Location">üîÑ</button>
                </div>
              </div>
              
              <div class="form-group full-width">
                <label for="bio">Biography (English)</label>
                <textarea id="bio" placeholder="Biography details..." style="min-height: 100px;"></textarea>
              </div>
              <div class="form-group full-width">
                <label for="bio_fa">Biography (Persian)</label>
                <textarea id="bio_fa" placeholder="ÿ®€åŸà⁄Øÿ±ÿßŸÅ€å..." style="min-height: 100px;" dir="rtl"></textarea>
              </div>
              
              <div class="form-group full-width">
                <label for="testimonials">Testimonials (English, one per line)</label>
                <textarea id="testimonials" placeholder="Quote | Author" style="min-height: 80px;"></textarea>
              </div>
              
              <div class="form-group">
                <label for="photo">Photo URL</label>
                <input id="photo" type="url" placeholder="https://..." />
              </div>
              <div class="form-group">
                <label for="xPost">X Post URL *</label>
                <div style="display: flex; gap: 0.5rem;">
                  <input id="xPost" type="url" placeholder="https://x.com/..." style="flex: 1;" required />
                  <button type="button" id="extract-img-btn" class="btn btn-secondary">Extract Img</button>
                </div>
              </div>
              
              <div class="form-group full-width">
                <label>References (Label | URL) - One per line *</label>
                <textarea id="references" placeholder="Wikipedia | https://en.wikipedia.org..." style="min-height: 80px;"></textarea>
              </div>
              
              <div class="form-group full-width" style="flex-direction: row; align-items: center; gap: 0.75rem;">
                <input type="checkbox" id="verified" style="width: 20px; height: 20px; cursor: pointer;" />
                <label for="verified" style="cursor: pointer;">Verify this entry (Show on live map)</label>
              </div>

              <div class="form-group" style="flex-direction: row; align-items: center; gap: 0.75rem;">
                <input type="checkbox" id="sensitive" style="width: 20px; height: 20px; cursor: pointer;" />
                <label for="sensitive" style="cursor: pointer;">Sensitive Text (Hide bio/testimonials by default)</label>
              </div>

              <div class="form-group" style="flex-direction: row; align-items: center; gap: 0.75rem;">
                <input type="checkbox" id="sensitive-media" style="width: 20px; height: 20px; cursor: pointer;" />
                <label for="sensitive-media" style="cursor: pointer;">Sensitive Media (Blur photo/video/xPost)</label>
              </div>
              
              <div class="form-group full-width" style="margin-top: 1rem;">
                <button type="submit" class="btn btn-primary" style="width: 100%;">Save Memorial</button>
              </div>
            </form>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>JSON Output</h3>
            </div>
            <pre id="output" style="background: #000; padding: 1rem; border-radius: 8px; overflow: auto; max-height: 300px; font-size: 0.8rem; border: 1px solid var(--border); color: #0f0;"></pre>
          </div>
        </section>
        <!-- Reports Section -->
        <section id="section-reports" class="hidden">
          <header>
            <h1>User Reports</h1>
            <div class="actions">
              <button id="refresh-reports-btn" class="btn btn-secondary btn-sm">Refresh Reports</button>
            </div>
          </header>
          
          <div class="card">
            <div style="overflow-x: auto;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Memorial</th>
                    <th>Reason</th>
                    <th>Details</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="reports-list">
                  <!-- Reports will be injected here -->
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>
    <script type="module" src="./src/admin.ts"></script>

    <!-- Merge Modal -->
    <div id="merge-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
      <div class="card" style="width: 90%; max-width: 500px; padding: 2rem; border: 1px solid var(--border);">
        <header style="margin-bottom: 1.5rem;">
          <h2 id="merge-modal-title">Merge Entry</h2>
        </header>
        <p style="margin-bottom: 1.5rem; color: var(--muted);">Select the target person to merge these references into. This will append all unique references to the target and <strong>delete</strong> the current entry.</p>
        
        <div class="form-group">
          <label for="merge-target-search">Search Target Person</label>
          <input id="merge-target-search" placeholder="Type name..." style="width: 100%;" />
        </div>

        <div id="merge-target-results" style="max-height: 200px; overflow-y: auto; margin-top: 1rem; border: 1px solid var(--border); border-radius: 4px; background: rgba(0,0,0,0.2);">
          <!-- Search results will be injected here -->
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          <button id="cancel-merge" class="btn btn-secondary" style="flex: 1;">Cancel</button>
          <button id="confirm-merge" class="btn btn-primary" style="flex: 1;" disabled>Confirm Merge</button>
        </div>
      </div>
    </div>
  </body>
</html>
